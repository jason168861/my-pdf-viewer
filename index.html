<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PDF 預覽器 (最終修正版)</title>
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/2.16.105/pdf.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/2.16.105/pdf.worker.min.js"></script>
    
    <style>
        /* --- 省略大部分與上一版相同的 CSS 樣式 --- */
        html, body { margin: 0; padding: 0; width: 100%; height: 100%; overflow: hidden; font-family: Arial, sans-serif; background-color: #525659; }
        body { display: flex; flex-direction: column; }
        #top-bar { background-color: #333; color: white; padding: 8px 16px; display: flex; align-items: center; flex-shrink: 0; box-shadow: 0 2px 5px rgba(0,0,0,0.4); z-index: 10; }
        #zoom-controls { margin-left: auto; display: flex; align-items: center; }
        #zoom-controls button { font-size: 16px; font-weight: bold; width: 32px; height: 32px; margin: 0 5px; border: 1px solid #555; background-color: #444; color: white; border-radius: 4px; cursor: pointer; }
        #zoom-controls button:hover { background-color: #555; }
        #zoom-percent { min-width: 50px; text-align: center; }
        #pdf-viewer { flex-grow: 1; overflow-y: auto; text-align: center; padding: 20px 0; transition: background-color 0.3s; }
        #pdf-viewer.drag-over { background-color: #3e6d8e; border: 4px dashed #fff; }
        .page-container { position: relative; margin: 0 auto 16px auto; box-shadow: 0 4px 8px rgba(0,0,0,0.2); }
        .page-container canvas, .page-container .textLayer { position: absolute; top: 0; left: 0; }
        .textLayer { line-height: 1; }
        .textLayer > span { color: transparent; position: absolute; white-space: pre; cursor: text; transform-origin: 0% 0%; }
        ::selection { background: rgba(0, 0, 255, 0.3); }

        /* --- 【新CSS】上傳按鈕區域 --- */
        #upload-container {
            display: flex;
            align-items: center;
        }

        #upload-button {
            padding: 6px 12px;
            background-color: #007bff;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
        }
        #upload-button:hover {
            background-color: #0056b3;
        }
        
        #file-name {
            margin-left: 12px;
            color: #ccc;
            font-size: 14px;
        }
    </style>
</head>
<body>

    <div id="top-bar">
        <div id="upload-container">
            <input type="file" id="pdf-upload" accept="application/pdf" style="display: none;">
            <button id="upload-button">選擇檔案</button>
            <span id="file-name">尚未選擇檔案</span>
        </div>

        <div id="zoom-controls">
            <button id="zoom-out">-</button>
            <span id="zoom-percent">100%</span>
            <button id="zoom-in">+</button>
        </div>
    </div>

    <div id="pdf-viewer">
        <p style="color: white; padding: 40px; border: 2px dashed #888; display: inline-block;">
            點擊「選擇檔案」或將 PDF 拖曳至此
        </p>
    </div>

    <script>
        pdfjsLib.GlobalWorkerOptions.workerSrc = `https://cdnjs.cloudflare.com/ajax/libs/pdf.js/2.16.105/pdf.worker.min.js`;

        let currentPdf = null;
        let currentScale = 1.5;

        // --- DOM 元素 (新增/修改) ---
        const viewer = document.getElementById('pdf-viewer');
        const uploadInput = document.getElementById('pdf-upload');
        const uploadButton = document.getElementById('upload-button'); // 新的按鈕
        const fileNameSpan = document.getElementById('file-name'); // 新的檔名顯示區
        const zoomInBtn = document.getElementById('zoom-in');
        const zoomOutBtn = document.getElementById('zoom-out');
        const zoomPercentSpan = document.getElementById('zoom-percent');

        // --- 檔案處理與渲染邏輯 ---
        async function loadFile(file) {
            if (!file || file.type !== 'application/pdf') {
                alert('請上傳 PDF 格式的檔案！');
                return;
            }

            // 【關鍵修正】更新檔名顯示
            fileNameSpan.textContent = file.name;
            viewer.innerHTML = '<p style="color: white;">正在載入檔案...</p>';
            
            try {
                const fileData = await file.arrayBuffer();
                const pdfDoc = await pdfjsLib.getDocument(new Uint8Array(fileData)).promise;
                currentPdf = pdfDoc;
                renderAllPages();
            } catch (error) {
                console.error('載入 PDF 時發生錯誤:', error);
                fileNameSpan.textContent = '檔案載入失敗';
                viewer.innerHTML = `<p style="color: red;">抱歉，無法載入此 PDF 檔案。</p>`;
            }
        }
        
        // renderAllPages, zoomIn, zoomOut, updateZoomDisplay 函式與上一版完全相同，此處省略以保持簡潔...
        async function renderAllPages() { /* ...與上一版相同... */ }
        function zoomIn() { /* ...與上一版相同... */ }
        function zoomOut() { /* ...與上一版相同... */ }
        function updateZoomDisplay() { /* ...與上一版相同... */ }
        // 為了讓範例可直接運作，底下補上完整函式
        async function renderAllPages(){if(!currentPdf)return;viewer.innerHTML='';updateZoomDisplay();for(let i=1;i<=currentPdf.numPages;i++){const page=await currentPdf.getPage(i);const viewport=page.getViewport({scale:currentScale});const pageContainer=document.createElement('div');pageContainer.className='page-container';pageContainer.style.width=`${viewport.width}px`;pageContainer.style.height=`${viewport.height}px`;viewer.appendChild(pageContainer);const canvas=document.createElement('canvas');const context=canvas.getContext('2d');canvas.width=viewport.width;canvas.height=viewport.height;pageContainer.appendChild(canvas);const textLayerDiv=document.createElement('div');textLayerDiv.className='textLayer';pageContainer.appendChild(textLayerDiv);await page.render({canvasContext:context,viewport:viewport}).promise;const textContent=await page.getTextContent();await pdfjsLib.renderTextLayer({textContent:textContent,container:textLayerDiv,viewport:viewport,textDivs:[]}).promise;}}
        function zoomIn(){if(currentScale>=3.0)return;currentScale+=0.25;renderAllPages();}
        function zoomOut(){if(currentScale<=0.25)return;currentScale-=0.25;renderAllPages();}
        function updateZoomDisplay(){zoomPercentSpan.textContent=`${Math.round(currentScale*100)}%`;}


        // --- 事件監聽 ---
        
        // 【新】代理點擊：點擊我們的新按鈕時，去觸發隱藏的 input
        uploadButton.addEventListener('click', () => uploadInput.click());

        // 監聽隱藏 input 的變化
        uploadInput.addEventListener('change', (e) => loadFile(e.target.files[0]));

        // 拖曳檔案事件
        viewer.addEventListener('dragover', (e) => { e.preventDefault(); viewer.classList.add('drag-over'); });
        viewer.addEventListener('dragleave', () => viewer.classList.remove('drag-over'));
        viewer.addEventListener('drop', (e) => {
            e.preventDefault();
            viewer.classList.remove('drag-over');
            loadFile(e.dataTransfer.files[0]);
        });

        // 滾輪縮放事件
        viewer.addEventListener('wheel', (e) => {
            if (e.ctrlKey || e.metaKey) {
                e.preventDefault();
                e.deltaY > 0 ? zoomOut() : zoomIn();
            }
        }, { passive: false });

        zoomInBtn.addEventListener('click', zoomIn);
        zoomOutBtn.addEventListener('click', zoomOut);

    </script>
</body>
</html>
